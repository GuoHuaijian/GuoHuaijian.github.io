(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[580],{69830:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>D});var s=r(95155),l=r(12115),a=r(52269),n=r(9670),i=r(55857),d=r(54265),o=r(81063),u=r(3951),x=r(32582),c=r(77498),h=r(80329),b=r(7782),j=r(50095),g=r(70680),p=r(24770),A=r(80158),m=r(20071),v=r(44146),y=r(89915),f=r(29414),S=r(33964),I=r(71023),k=r(35695),C=r(25680),w=r(24988),R=r(36971);let D=()=>{let{user:e}=(0,C.A)(),t=(0,k.useRouter)(),[r,D]=(0,l.useState)(!1),[W,O]=(0,l.useState)(!1),[P,B]=(0,l.useState)(null),[_,q]=(0,l.useState)(""),[E,L]=(0,l.useState)(""),[M,N]=(0,l.useState)(""),[T,F]=(0,l.useState)([]),[Y,z]=(0,l.useState)(""),[H,K]=(0,l.useState)(new Date().toISOString().split("T")[0]),[U,G]=(0,l.useState)(new Date(new Date().setMonth(new Date().getMonth()+1)).toISOString().split("T")[0]),[J,Q]=(0,l.useState)(0),[V,X]=(0,l.useState)(1),[Z,$]=(0,l.useState)("规划中"),[ee,et]=(0,l.useState)(0),[er,es]=(0,l.useState)(null),[el,ea]=(0,l.useState)(null),en=(0,l.useRef)(null),ei=()=>{Y&&!T.includes(Y)&&T.length<5&&(F([...T,Y]),z(""))},ed=e=>{F(T.filter(t=>t!==e))},eo=async r=>{if(r.preventDefault(),!_||!E||!M||!H||!U){B("请填写所有必填字段");return}if(H&&U&&H>U){B("结束日期必须晚于开始日期");return}try{D(!0),B(null);let r={title:_,description:E,category:M,tags:T,creatorId:(null==e?void 0:e.id)||"",startDate:new Date(H).toISOString(),endDate:new Date(U).toISOString(),status:Z,progress:ee,members:[(null==e?void 0:e.id)||""],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),tasks:[]},s=await R.hI.create(r);O(!0),setTimeout(()=>{t.push("/projects/".concat(s.id))},1500)}catch(e){console.error("Error creating project:",e),B("创建项目时出错，请稍后再试")}finally{D(!1)}};return e?(0,s.jsxs)(w.A,{sx:{mt:8},children:[(0,s.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",mb:4,position:"relative","&::before":{content:'""',position:"absolute",left:0,top:"50%",width:4,height:"40px",transform:"translateY(-50%)",background:"linear-gradient(to bottom, #1976d2, #42a5f5)",borderRadius:"0 4px 4px 0"},pl:3},children:[(0,s.jsx)(i.A,{startIcon:(0,s.jsx)(f.A,{}),onClick:()=>t.back(),sx:{mr:2},children:"返回"}),(0,s.jsxs)(a.A,{children:[(0,s.jsx)(n.A,{variant:"h4",component:"h1",gutterBottom:!0,sx:{fontWeight:700},children:"创建新项目"}),(0,s.jsx)(n.A,{variant:"body1",color:"text.secondary",children:"创建一个新项目并邀请团队成员加入协作"})]})]}),P&&(0,s.jsx)(d.A,{severity:"error",sx:{mb:3},children:P}),W&&(0,s.jsx)(d.A,{severity:"success",sx:{mb:3},children:"项目创建成功！正在跳转到项目详情页..."}),(0,s.jsx)(o.A,{elevation:0,sx:{p:4,borderRadius:2,border:"1px solid rgba(33, 150, 243, 0.1)",background:"linear-gradient(to right, rgba(255, 255, 255, 0.9), rgba(246, 249, 252, 0.9))"},children:(0,s.jsx)("form",{onSubmit:eo,children:(0,s.jsxs)(u.Ay,{container:!0,spacing:3,children:[(0,s.jsx)(u.Ay,{item:!0,xs:12,children:(0,s.jsx)(x.A,{label:"项目名称",placeholder:"给您的项目起一个名称",fullWidth:!0,required:!0,value:_,onChange:e=>q(e.target.value),variant:"outlined",InputProps:{sx:{borderRadius:1.5}}})}),(0,s.jsx)(u.Ay,{item:!0,xs:12,children:(0,s.jsx)(x.A,{label:"项目描述",placeholder:"详细描述您的项目，包括目标、背景、预期成果等",fullWidth:!0,required:!0,multiline:!0,rows:5,value:E,onChange:e=>L(e.target.value),variant:"outlined",InputProps:{sx:{borderRadius:1.5}}})}),(0,s.jsx)(u.Ay,{item:!0,xs:12,sm:6,children:(0,s.jsxs)(c.A,{fullWidth:!0,required:!0,children:[(0,s.jsx)(h.A,{id:"category-label",children:"项目分类"}),(0,s.jsx)(b.A,{labelId:"category-label",value:M,label:"项目分类",onChange:e=>N(e.target.value),sx:{borderRadius:1.5},children:["技术开发","艺术创作","社会公益","教育培训","环境保护","健康医疗","其他"].map(e=>(0,s.jsx)(j.A,{value:e,children:e},e))})]})}),(0,s.jsx)(u.Ay,{item:!0,xs:12,sm:6,children:(0,s.jsxs)(c.A,{fullWidth:!0,children:[(0,s.jsx)(h.A,{id:"status-label",children:"项目状态"}),(0,s.jsx)(b.A,{labelId:"status-label",value:Z,label:"项目状态",onChange:e=>$(e.target.value),sx:{borderRadius:1.5},children:[{value:"规划中",label:"规划中"},{value:"进行中",label:"进行中"},{value:"已完成",label:"已完成"},{value:"已暂停",label:"已暂停"}].map(e=>(0,s.jsx)(j.A,{value:e.value,children:e.label},e.value))})]})}),(0,s.jsx)(u.Ay,{item:!0,xs:12,sm:6,children:(0,s.jsx)(x.A,{label:"开始日期",type:"date",fullWidth:!0,required:!0,value:H,onChange:e=>K(e.target.value),InputLabelProps:{shrink:!0},sx:{".MuiOutlinedInput-root":{borderRadius:1.5}}})}),(0,s.jsx)(u.Ay,{item:!0,xs:12,sm:6,children:(0,s.jsx)(x.A,{label:"预计完成日期",type:"date",fullWidth:!0,required:!0,value:U,onChange:e=>G(e.target.value),InputLabelProps:{shrink:!0},sx:{".MuiOutlinedInput-root":{borderRadius:1.5}}})}),(0,s.jsx)(u.Ay,{item:!0,xs:12,sm:6,children:(0,s.jsx)(x.A,{label:"预算",type:"number",fullWidth:!0,value:J,onChange:e=>Q(Number(e.target.value)),InputProps:{startAdornment:(0,s.jsx)(g.A,{position:"start",children:"\xa5"}),sx:{borderRadius:1.5}}})}),(0,s.jsx)(u.Ay,{item:!0,xs:12,sm:6,children:(0,s.jsxs)(a.A,{sx:{px:2},children:[(0,s.jsx)(n.A,{gutterBottom:!0,children:"团队规模"}),(0,s.jsxs)(u.Ay,{container:!0,spacing:2,alignItems:"center",children:[(0,s.jsx)(u.Ay,{item:!0,xs:!0,children:(0,s.jsx)(p.Ay,{value:V,onChange:(e,t)=>X(t),min:1,max:10,valueLabelDisplay:"auto"})}),(0,s.jsx)(u.Ay,{item:!0,children:(0,s.jsxs)(n.A,{children:[V," 人"]})})]})]})}),(0,s.jsx)(u.Ay,{item:!0,xs:12,children:(0,s.jsxs)(a.A,{sx:{px:2},children:[(0,s.jsxs)(n.A,{gutterBottom:!0,children:["项目进度 (",ee,"%)"]}),(0,s.jsx)(p.Ay,{value:ee,onChange:(e,t)=>et(t),valueLabelDisplay:"auto"})]})}),(0,s.jsxs)(u.Ay,{item:!0,xs:12,children:[(0,s.jsx)(A.A,{sx:{my:1}}),(0,s.jsxs)(a.A,{sx:{mb:1},children:[(0,s.jsx)(n.A,{variant:"subtitle2",gutterBottom:!0,children:"标签（最多5个）"}),(0,s.jsxs)(a.A,{sx:{display:"flex",alignItems:"flex-start"},children:[(0,s.jsx)(x.A,{placeholder:"添加标签",fullWidth:!0,value:Y,onChange:e=>z(e.target.value),onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),ei())},sx:{mr:1},InputProps:{sx:{borderRadius:1.5}}}),(0,s.jsx)(i.A,{variant:"outlined",onClick:ei,disabled:!Y||T.length>=5,children:"添加"})]})]}),(0,s.jsx)(a.A,{sx:{mt:2,display:"flex",flexWrap:"wrap",gap:1},children:T.map(e=>(0,s.jsx)(m.A,{label:e,onDelete:()=>ed(e),sx:{borderRadius:"6px",backgroundColor:"rgba(33, 150, 243, 0.08)",color:"#1976d2",border:"1px solid rgba(33, 150, 243, 0.12)"}},e))})]}),(0,s.jsxs)(u.Ay,{item:!0,xs:12,children:[(0,s.jsx)(A.A,{sx:{my:2}}),(0,s.jsx)(n.A,{variant:"subtitle2",gutterBottom:!0,children:"上传项目封面（可选）"}),(0,s.jsx)("input",{type:"file",accept:"image/*",style:{display:"none"},onChange:e=>{let t=e.target.files&&e.target.files[0];if(t){es(t);let e=new FileReader;e.onload=()=>{ea(e.result)},e.readAsDataURL(t)}},ref:en}),el?(0,s.jsxs)(a.A,{sx:{mt:2,position:"relative"},children:[(0,s.jsx)("img",{src:el,alt:"Preview",style:{maxWidth:"100%",maxHeight:"200px",borderRadius:"8px",objectFit:"cover"}}),(0,s.jsx)(v.A,{onClick:()=>{es(null),ea(null),en.current&&(en.current.value="")},sx:{position:"absolute",top:8,right:8,bgcolor:"rgba(0,0,0,0.6)",color:"white","&:hover":{bgcolor:"rgba(0,0,0,0.8)"}},children:(0,s.jsx)(I.A,{})})]}):(0,s.jsx)(i.A,{variant:"outlined",startIcon:(0,s.jsx)(S.A,{}),onClick:()=>{var e;return null===(e=en.current)||void 0===e?void 0:e.click()},sx:{borderRadius:1.5,p:1.5,borderStyle:"dashed"},children:"选择图片"})]}),(0,s.jsxs)(u.Ay,{item:!0,xs:12,sx:{mt:3,display:"flex",justifyContent:"flex-end"},children:[(0,s.jsx)(i.A,{variant:"outlined",onClick:()=>t.back(),sx:{mr:2},children:"取消"}),(0,s.jsx)(i.A,{type:"submit",variant:"contained",disabled:r||!_||!E||!M||!H||!U,startIcon:r&&(0,s.jsx)(y.A,{size:20,color:"inherit"}),sx:{minWidth:120,background:"linear-gradient(45deg, #1976d2 30%, #42a5f5 90%)",transition:"all 0.3s ease","&:hover":{background:"linear-gradient(45deg, #0d47a1 30%, #1976d2 90%)",boxShadow:"0 6px 20px rgba(33, 150, 243, 0.3)",transform:"translateY(-2px)"}},children:r?"提交中...":"创建项目"})]})]})})})]}):(0,s.jsx)(w.A,{children:(0,s.jsxs)(a.A,{sx:{textAlign:"center",py:8},children:[(0,s.jsx)(n.A,{variant:"h6",gutterBottom:!0,children:"请先登录"}),(0,s.jsx)(n.A,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:"您需要登录才能创建项目"}),(0,s.jsx)(i.A,{variant:"contained",onClick:()=>t.push("/login"),sx:{mt:2},children:"前往登录"})]})})}},96962:(e,t,r)=>{Promise.resolve().then(r.bind(r,69830))}},e=>{var t=t=>e(e.s=t);e.O(0,[827,364,34,951,948,582,644,631,680,988,441,684,358],()=>t(96962)),_N_E=e.O()}]);