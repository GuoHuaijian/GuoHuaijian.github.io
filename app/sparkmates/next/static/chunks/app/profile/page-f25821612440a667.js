(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[636],{33246:(e,i,t)=>{"use strict";t.r(i),t.d(i,{default:()=>L});var s=t(95155),n=t(12115),r=t(52269),a=t(63159),l=t(3951),o=t(81063),c=t(68086),d=t(54265),x=t(55857),h=t(86223),j=t(44146),A=t(55398),p=t(32582),m=t(9670),y=t(95439),u=t(40463),b=t(34152),v=t(80158),g=t(75236),f=t(80460),w=t(84256),C=t(83339),k=t(20071),W=t(62861),I=t(62966),S=t(12422),T=t(42921),B=t(78679),P=t(18307),R=t(18478),E=t(59869),z=t(1384),O=t(15843),F=t(35695),_=t(25680),G=t(36971),D=t(59434),N=t(24988);function q(e){let{children:i,value:t,index:n,...a}=e;return(0,s.jsx)("div",{role:"tabpanel",hidden:t!==n,id:"profile-tabpanel-".concat(n),"aria-labelledby":"profile-tab-".concat(n),...a,children:t===n&&(0,s.jsx)(r.A,{sx:{py:3},children:i})})}let L=()=>{let e=(0,F.useRouter)(),{user:i,loading:t,logout:L}=(0,_.A)(),[U,Y]=(0,n.useState)(null),[J,V]=(0,n.useState)(!1),[Z,M]=(0,n.useState)([]),[H,K]=(0,n.useState)([]),[Q,X]=(0,n.useState)(!0),[$,ee]=(0,n.useState)(null),[ei,et]=(0,n.useState)(0),[es,en]=(0,n.useState)({name:"",email:"",bio:"",role:"",company:"",location:"",website:"",avatar:""}),[er,ea]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(async()=>{if(!t){if(!i){e.push("/login");return}try{X(!0);let e=await G.Zw.getById(i.id);if(!e){ee("无法加载用户信息");return}Y(e),en({name:e.name||"",email:e.email||"",bio:e.bio||"",role:e.role||"",company:e.company||"",location:e.location||"",website:e.website||"",avatar:e.avatar||""});let t=await G.hI.getByUser(i.id);M(t||[]);let s=await G.f3.getByUser(i.id);K(s||[])}catch(e){console.error("Error fetching profile data:",e),ee("加载个人信息时出错")}finally{X(!1)}}})()},[i,t,e]);let el=e=>{let{name:i,value:t}=e.target;en(e=>({...e,[i]:t}))},eo=async()=>{if(U)try{Y({...U,...es}),V(!1),alert("个人资料已更新")}catch(e){console.error("Error updating profile:",e),ee("更新个人资料时出错")}};return Q||t?(0,s.jsx)(N.A,{children:(0,s.jsx)(a.A,{maxWidth:"lg",children:(0,s.jsxs)(l.Ay,{container:!0,spacing:4,children:[(0,s.jsx)(l.Ay,{item:!0,xs:12,md:4,children:(0,s.jsxs)(o.A,{elevation:0,sx:{p:3,mb:3,borderRadius:2},children:[(0,s.jsxs)(r.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:3},children:[(0,s.jsx)(c.A,{variant:"circular",width:100,height:100}),(0,s.jsx)(c.A,{variant:"text",width:"60%",height:40,sx:{mt:1}}),(0,s.jsx)(c.A,{variant:"text",width:"40%",height:20})]}),(0,s.jsx)(c.A,{variant:"text",height:30,sx:{mb:1}}),(0,s.jsx)(c.A,{variant:"text",height:30,sx:{mb:1}}),(0,s.jsx)(c.A,{variant:"text",height:30,sx:{mb:1}})]})}),(0,s.jsxs)(l.Ay,{item:!0,xs:12,md:8,children:[(0,s.jsx)(c.A,{variant:"rectangular",height:200,sx:{mb:3,borderRadius:2}}),(0,s.jsx)(c.A,{variant:"rectangular",height:300,sx:{borderRadius:2}})]})]})})}):$||!U?(0,s.jsx)(N.A,{children:(0,s.jsxs)(a.A,{maxWidth:"lg",children:[(0,s.jsx)(d.A,{severity:"error",sx:{mt:4},children:$||"无法加载个人信息"}),(0,s.jsx)(r.A,{sx:{mt:2,textAlign:"center"},children:(0,s.jsx)(x.A,{variant:"outlined",onClick:()=>e.push("/"),children:"返回首页"})})]})}):(0,s.jsxs)(N.A,{sx:{mt:8},children:[(0,s.jsx)(a.A,{maxWidth:"lg",children:(0,s.jsxs)(l.Ay,{container:!0,spacing:4,children:[(0,s.jsxs)(l.Ay,{item:!0,xs:12,md:4,children:[(0,s.jsxs)(o.A,{elevation:0,sx:{p:3,mb:3,borderRadius:2},children:[(0,s.jsxs)(r.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:3},children:[J?(0,s.jsx)(h.A,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},badgeContent:(0,s.jsxs)(j.A,{sx:{bgcolor:"primary.main",color:"white",width:32,height:32,"&:hover":{bgcolor:"primary.dark"}},component:"label",children:[(0,s.jsx)(P.A,{fontSize:"small"}),(0,s.jsx)("input",{hidden:!0,accept:"image/*",type:"file"})]}),children:(0,s.jsx)(A.A,{src:(0,D.TW)(es.avatar),alt:es.name,sx:{width:100,height:100,mb:2}})}):(0,s.jsx)(A.A,{src:(0,D.TW)(U.avatar),alt:U.name,sx:{width:100,height:100,mb:2}}),J?(0,s.jsx)(p.A,{fullWidth:!0,variant:"outlined",name:"name",label:"姓名",value:es.name,onChange:el,sx:{mb:1}}):(0,s.jsx)(m.A,{variant:"h5",fontWeight:"bold",gutterBottom:!0,children:U.name}),!J&&(0,s.jsx)(m.A,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:U.role||"未设置职位"})]}),(0,s.jsx)(r.A,{sx:{mb:3},children:J?(0,s.jsxs)(l.Ay,{container:!0,spacing:2,children:[(0,s.jsx)(l.Ay,{item:!0,xs:12,children:(0,s.jsx)(p.A,{fullWidth:!0,variant:"outlined",name:"role",label:"职位",value:es.role,onChange:el})}),(0,s.jsx)(l.Ay,{item:!0,xs:12,children:(0,s.jsx)(p.A,{fullWidth:!0,variant:"outlined",name:"email",label:"邮箱",value:es.email,onChange:el})}),(0,s.jsx)(l.Ay,{item:!0,xs:12,children:(0,s.jsx)(p.A,{fullWidth:!0,variant:"outlined",name:"company",label:"公司/组织",value:es.company,onChange:el})}),(0,s.jsx)(l.Ay,{item:!0,xs:12,children:(0,s.jsx)(p.A,{fullWidth:!0,variant:"outlined",name:"location",label:"所在地",value:es.location,onChange:el})}),(0,s.jsx)(l.Ay,{item:!0,xs:12,children:(0,s.jsx)(p.A,{fullWidth:!0,variant:"outlined",name:"website",label:"个人网站",value:es.website,onChange:el})}),(0,s.jsx)(l.Ay,{item:!0,xs:12,children:(0,s.jsx)(p.A,{fullWidth:!0,multiline:!0,rows:4,variant:"outlined",name:"bio",label:"个人简介",value:es.bio,onChange:el})})]}):(0,s.jsxs)(y.A,{disablePadding:!0,children:[(0,s.jsx)(u.Ay,{disableGutters:!0,sx:{py:1},children:(0,s.jsx)(b.A,{primary:"邮箱",secondary:U.email||"未设置邮箱",primaryTypographyProps:{variant:"subtitle2"}})}),(0,s.jsx)(v.A,{component:"li"}),(0,s.jsx)(u.Ay,{disableGutters:!0,sx:{py:1},children:(0,s.jsx)(b.A,{primary:"公司/组织",secondary:U.company||"未设置公司/组织",primaryTypographyProps:{variant:"subtitle2"}})}),(0,s.jsx)(v.A,{component:"li"}),(0,s.jsx)(u.Ay,{disableGutters:!0,sx:{py:1},children:(0,s.jsx)(b.A,{primary:"所在地",secondary:U.location||"未设置所在地",primaryTypographyProps:{variant:"subtitle2"}})}),(0,s.jsx)(v.A,{component:"li"}),(0,s.jsx)(u.Ay,{disableGutters:!0,sx:{py:1},children:(0,s.jsx)(b.A,{primary:"个人网站",secondary:U.website||"未设置个人网站",primaryTypographyProps:{variant:"subtitle2"}})}),(0,s.jsx)(v.A,{component:"li"}),(0,s.jsx)(u.Ay,{disableGutters:!0,sx:{py:1},children:(0,s.jsx)(b.A,{primary:"个人简介",secondary:U.bio||"未设置个人简介",primaryTypographyProps:{variant:"subtitle2"},secondaryTypographyProps:{sx:{whiteSpace:"pre-line"}}})})]})}),(0,s.jsx)(r.A,{sx:{display:"flex",justifyContent:"space-between"},children:J?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.A,{variant:"outlined",startIcon:(0,s.jsx)(R.A,{}),onClick:()=>{U&&(en({name:U.name||"",email:U.email||"",bio:U.bio||"",role:U.role||"",company:U.company||"",location:U.location||"",website:U.website||"",avatar:U.avatar||""}),V(!1))},color:"error",children:"取消"}),(0,s.jsx)(x.A,{variant:"contained",startIcon:(0,s.jsx)(E.A,{}),onClick:eo,children:"保存"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.A,{variant:"outlined",color:"error",onClick:()=>{ea(!0)},children:"退出登录"}),(0,s.jsx)(x.A,{variant:"contained",startIcon:(0,s.jsx)(z.A,{}),onClick:()=>V(!0),children:"编辑资料"})]})})]}),(0,s.jsxs)(o.A,{elevation:0,sx:{p:3,borderRadius:2},children:[(0,s.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"统计数据"}),(0,s.jsxs)(l.Ay,{container:!0,spacing:2,children:[(0,s.jsx)(l.Ay,{item:!0,xs:6,children:(0,s.jsxs)(r.A,{sx:{textAlign:"center",p:2},children:[(0,s.jsx)(m.A,{variant:"h4",color:"primary",children:Z.length}),(0,s.jsx)(m.A,{variant:"body2",color:"text.secondary",children:"项目"})]})}),(0,s.jsx)(l.Ay,{item:!0,xs:6,children:(0,s.jsxs)(r.A,{sx:{textAlign:"center",p:2},children:[(0,s.jsx)(m.A,{variant:"h4",color:"primary",children:H.length}),(0,s.jsx)(m.A,{variant:"body2",color:"text.secondary",children:"创意"})]})})]})]})]}),(0,s.jsx)(l.Ay,{item:!0,xs:12,md:8,children:(0,s.jsxs)(o.A,{elevation:0,sx:{borderRadius:2},children:[(0,s.jsx)(r.A,{sx:{borderBottom:1,borderColor:"divider"},children:(0,s.jsxs)(g.A,{value:ei,onChange:(e,i)=>{et(i)},variant:"fullWidth",children:[(0,s.jsx)(f.A,{label:"我的项目"}),(0,s.jsx)(f.A,{label:"我的创意"})]})}),(0,s.jsxs)(q,{value:ei,index:0,children:[(0,s.jsxs)(r.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,s.jsxs)(m.A,{variant:"h6",children:["我的项目 (",Z.length,")"]}),(0,s.jsx)(x.A,{variant:"contained",startIcon:(0,s.jsx)(O.A,{}),onClick:()=>e.push("/projects/new"),children:"创建项目"})]}),Z.length>0?(0,s.jsx)(l.Ay,{container:!0,spacing:3,children:Z.map(i=>(0,s.jsx)(l.Ay,{item:!0,xs:12,sm:6,children:(0,s.jsx)(w.A,{variant:"outlined",sx:{borderRadius:2,cursor:"pointer",transition:"all 0.2s","&:hover":{boxShadow:3}},onClick:()=>e.push("/projects/".concat(i.id)),children:(0,s.jsxs)(C.A,{children:[(0,s.jsxs)(r.A,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[(0,s.jsx)(m.A,{variant:"h6",noWrap:!0,sx:{maxWidth:"80%"},children:i.title}),(0,s.jsx)(k.A,{label:i.status,size:"small",color:"已完成"===i.status?"success":"进行中"===i.status?"primary":"default"})]}),(0,s.jsx)(m.A,{variant:"body2",color:"text.secondary",sx:{mb:2,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:(0,D.EJ)(i.description,100)}),(0,s.jsxs)(r.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,s.jsx)(k.A,{label:i.category,size:"small",variant:"outlined"}),(0,s.jsxs)(m.A,{variant:"caption",color:"text.secondary",children:["创建于 ",(0,D.Yq)(i.createdAt)]})]})]})})},i.id))}):(0,s.jsxs)(r.A,{sx:{textAlign:"center",py:4},children:[(0,s.jsx)(m.A,{color:"text.secondary",paragraph:!0,children:"你还没有创建任何项目"}),(0,s.jsx)(x.A,{variant:"outlined",startIcon:(0,s.jsx)(O.A,{}),onClick:()=>e.push("/projects/new"),children:"创建第一个项目"})]})]}),(0,s.jsxs)(q,{value:ei,index:1,children:[(0,s.jsxs)(r.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,s.jsxs)(m.A,{variant:"h6",children:["我的创意 (",H.length,")"]}),(0,s.jsx)(x.A,{variant:"contained",startIcon:(0,s.jsx)(O.A,{}),onClick:()=>e.push("/ideas/new"),children:"分享创意"})]}),H.length>0?(0,s.jsx)(l.Ay,{container:!0,spacing:3,children:H.map(i=>(0,s.jsx)(l.Ay,{item:!0,xs:12,children:(0,s.jsx)(w.A,{variant:"outlined",sx:{borderRadius:2,cursor:"pointer",transition:"all 0.2s","&:hover":{boxShadow:3}},onClick:()=>e.push("/ideas/".concat(i.id)),children:(0,s.jsxs)(C.A,{children:[(0,s.jsxs)(r.A,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[(0,s.jsx)(m.A,{variant:"h6",children:i.title}),(0,s.jsx)(k.A,{label:i.visibility,size:"small",color:"PUBLIC"===i.visibility?"success":"PRIVATE"===i.visibility?"error":"default"})]}),(0,s.jsx)(m.A,{variant:"body2",color:"text.secondary",sx:{mb:2,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical"},children:i.description}),(0,s.jsx)(r.A,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:2},children:i.tags.map((e,i)=>(0,s.jsx)(k.A,{label:e,size:"small",variant:"outlined"},i))}),(0,s.jsxs)(r.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,s.jsxs)(m.A,{variant:"caption",color:"text.secondary",children:["创建于 ",(0,D.Yq)(i.createdAt)]}),(0,s.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,s.jsxs)(m.A,{variant:"caption",color:"text.secondary",children:[i.likes||0," 赞"]}),(0,s.jsxs)(m.A,{variant:"caption",color:"text.secondary",children:[i.comments||0," 评论"]})]})]})]})})},i.id))}):(0,s.jsxs)(r.A,{sx:{textAlign:"center",py:4},children:[(0,s.jsx)(m.A,{color:"text.secondary",paragraph:!0,children:"你还没有分享任何创意"}),(0,s.jsx)(x.A,{variant:"outlined",startIcon:(0,s.jsx)(O.A,{}),onClick:()=>e.push("/ideas/new"),children:"分享第一个创意"})]})]})]})})]})}),(0,s.jsxs)(W.A,{open:er,onClose:()=>ea(!1),children:[(0,s.jsx)(I.A,{children:"确认退出登录"}),(0,s.jsx)(S.A,{children:(0,s.jsx)(T.A,{children:"你确定要退出登录吗？退出后需要重新登录才能访问个人账户。"})}),(0,s.jsxs)(B.A,{children:[(0,s.jsx)(x.A,{onClick:()=>ea(!1),children:"取消"}),(0,s.jsx)(x.A,{onClick:()=>{L(),ea(!1),e.push("/login")},color:"error",autoFocus:!0,children:"确认退出"})]})]})]})}},59434:(e,i,t)=>{"use strict";t.d(i,{EJ:()=>a,TW:()=>s,Yq:()=>n,ZV:()=>r});let s=(e,i)=>e&&!e.includes("placeholder")?e:"/avatars/placeholder.svg",n=e=>{let i=new Date(e);return new Intl.DateTimeFormat("zh-CN",{year:"numeric",month:"long",day:"numeric"}).format(i)},r=e=>e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"k":e.toString(),a=(e,i)=>e.length<=i?e:e.slice(0,i)+"..."},78032:(e,i,t)=>{Promise.resolve().then(t.bind(t,33246))}},e=>{var i=i=>e(e.s=i);e.O(0,[827,364,34,951,948,582,501,309,904,680,988,441,684,358],()=>i(78032)),_N_E=e.O()}]);