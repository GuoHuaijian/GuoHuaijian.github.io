(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[451],{1409:(e,t,r)=>{Promise.resolve().then(r.bind(r,88562))},26126:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var n=r(89019),i=r(95155);let s=(0,n.A)((0,i.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send")},38870:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var n=r(89019),i=r(95155);let s=(0,n.A)((0,i.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert")},53537:(e,t,r)=>{"use strict";r.d(t,{A:()=>m});var n=r(12115),i=r(52596),s=r(15386),o=r(45115),l=r(35881),a=r(82700),d=r(57692),c=r(81112);function x(e){return(0,c.Ay)("MuiListItemAvatar",e)}(0,d.A)("MuiListItemAvatar",["root","alignItemsFlexStart"]);var h=r(95155);let p=e=>{let{alignItems:t,classes:r}=e;return(0,s.A)({root:["root","flex-start"===t&&"alignItemsFlexStart"]},x,r)},u=(0,l.Ay)("div",{name:"MuiListItemAvatar",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:r}=e;return[t.root,"flex-start"===r.alignItems&&t.alignItemsFlexStart]}})({minWidth:56,flexShrink:0,variants:[{props:{alignItems:"flex-start"},style:{marginTop:8}}]}),m=n.forwardRef(function(e,t){let r=(0,a.b)({props:e,name:"MuiListItemAvatar"}),{className:s,...l}=r,d=n.useContext(o.A),c={...r,alignItems:d.alignItems},x=p(c);return(0,h.jsx)(u,{className:(0,i.A)(x.root,s),ownerState:c,ref:t,...l})})},59434:(e,t,r)=>{"use strict";r.d(t,{EJ:()=>o,TW:()=>n,Yq:()=>i,ZV:()=>s});let n=(e,t)=>e&&!e.includes("placeholder")?e:"/avatars/placeholder.svg",i=e=>{let t=new Date(e);return new Intl.DateTimeFormat("zh-CN",{year:"numeric",month:"long",day:"numeric"}).format(t)},s=e=>e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"k":e.toString(),o=(e,t)=>e.length<=t?e:e.slice(0,t)+"..."},70680:(e,t,r)=>{"use strict";r.d(t,{A:()=>y});var n,i=r(12115),s=r(52596),o=r(15386),l=r(39571),a=r(9670),d=r(25377),c=r(91285),x=r(35881),h=r(74409),p=r(82700),u=r(57692),m=r(81112);function v(e){return(0,m.Ay)("MuiInputAdornment",e)}let f=(0,u.A)("MuiInputAdornment",["root","filled","standard","outlined","positionStart","positionEnd","disablePointerEvents","hiddenLabel","sizeSmall"]);var A=r(95155);let g=e=>{let{classes:t,disablePointerEvents:r,hiddenLabel:n,position:i,size:s,variant:a}=e,d={root:["root",r&&"disablePointerEvents",i&&"position".concat((0,l.A)(i)),a,n&&"hiddenLabel",s&&"size".concat((0,l.A)(s))]};return(0,o.A)(d,v,t)},j=(0,x.Ay)("div",{name:"MuiInputAdornment",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:r}=e;return[t.root,t["position".concat((0,l.A)(r.position))],!0===r.disablePointerEvents&&t.disablePointerEvents,t[r.variant]]}})((0,h.A)(e=>{let{theme:t}=e;return{display:"flex",maxHeight:"2em",alignItems:"center",whiteSpace:"nowrap",color:(t.vars||t).palette.action.active,variants:[{props:{variant:"filled"},style:{["&.".concat(f.positionStart,"&:not(.").concat(f.hiddenLabel,")")]:{marginTop:16}}},{props:{position:"start"},style:{marginRight:8}},{props:{position:"end"},style:{marginLeft:8}},{props:{disablePointerEvents:!0},style:{pointerEvents:"none"}}]}})),y=i.forwardRef(function(e,t){let r=(0,p.b)({props:e,name:"MuiInputAdornment"}),{children:o,className:l,component:x="div",disablePointerEvents:h=!1,disableTypography:u=!1,position:m,variant:v,...f}=r,y=(0,c.A)()||{},b=v;v&&y.variant,y&&!b&&(b=y.variant);let w={...r,hiddenLabel:y.hiddenLabel,size:y.size,disablePointerEvents:h,position:m,variant:b},C=g(w);return(0,A.jsx)(d.A.Provider,{value:null,children:(0,A.jsx)(j,{as:x,ownerState:w,className:(0,s.A)(C.root,l),ref:t,...f,children:"string"!=typeof o||u?(0,A.jsxs)(i.Fragment,{children:["start"===m?n||(n=(0,A.jsx)("span",{className:"notranslate","aria-hidden":!0,children:"​"})):null,o]}):(0,A.jsx)(a.A,{color:"textSecondary",children:o})})})})},88562:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>F});var n=r(95155),i=r(12115),s=r(35881),o=r(80460),l=r(40463),a=r(53537),d=r(86223),c=r(55398),x=r(34152),h=r(52269),p=r(9670),u=r(20071),m=r(81063),v=r(3951),f=r(32582),A=r(70680),g=r(75236),j=r(95439),y=r(89915),b=r(44146),w=r(55857),C=r(89019);let I=(0,C.A)((0,n.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2"}),"Circle");var S=r(84092),M=r(38870);let k=(0,C.A)((0,n.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M8.5 8c.83 0 1.5.67 1.5 1.5S9.33 11 8.5 11 7 10.33 7 9.5 7.67 8 8.5 8M12 18c-2.28 0-4.22-1.66-5-4h10c-.78 2.34-2.72 4-5 4m3.5-7c-.83 0-1.5-.67-1.5-1.5S14.67 8 15.5 8s1.5.67 1.5 1.5-.67 1.5-1.5 1.5"}),"EmojiEmotions"),z=(0,C.A)((0,n.jsx)("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6z"}),"AttachFile"),E=(0,C.A)((0,n.jsx)("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2M8.5 13.5l2.5 3.01L14.5 12l4.5 6H5z"}),"Image");var R=r(26126),W=r(25680),L=r(36971),T=r(59434),P=r(24988);let D=(0,s.Ay)(o.A)(e=>{let{theme:t}=e;return{minHeight:"48px",fontSize:"14px",fontWeight:500,textTransform:"none"}}),F=()=>{var e,t;let{user:r}=(0,W.A)(),[s,o]=(0,i.useState)([]),[C,F]=(0,i.useState)([]),[V,H]=(0,i.useState)(!0),[N,_]=(0,i.useState)(""),[O,Y]=(0,i.useState)(""),[G,K]=(0,i.useState)(0),[q,B]=(0,i.useState)(null),J=(0,i.useRef)(null);(0,i.useEffect)(()=>{(async()=>{try{H(!0);let e=await L.nK.getConversations();o(e),e.length>0&&B(e[0])}catch(e){console.error("Error fetching conversations:",e)}finally{H(!1)}})()},[]),(0,i.useEffect)(()=>{(async()=>{if(q)try{H(!0);let e=await L.nK.getMessagesByConversation(q.id);F(e)}catch(e){console.error("Error fetching messages:",e)}finally{H(!1)}})()},[q]),(0,i.useEffect)(()=>{J.current&&C.length>0&&setTimeout(()=>{var e;null===(e=J.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"end"})},100)},[C]);let Z=s.filter(e=>{var t;let r=e.participants.map(e=>e.name).join(" ").toLowerCase(),n=(null===(t=e.lastMessage)||void 0===t?void 0:t.content.toLowerCase())||"",i=O.toLowerCase();return r.includes(i)||n.includes(i)}),Q=()=>{if(!N.trim()||!q)return;let e={id:String(Math.random()),conversationId:q.id,sender:(null==r?void 0:r.id)||"",content:N,createdAt:new Date().toISOString(),read:!0};F(t=>[...t,e]),_("")};return r?(0,n.jsx)(P.A,{sx:{mt:8},withPaper:!1,children:(0,n.jsx)(m.A,{elevation:1,sx:{width:"100%",height:"calc(100vh - 180px)",maxHeight:"80vh",borderRadius:2,display:"flex",overflow:"hidden",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.05)",border:"1px solid",borderColor:"rgba(33, 150, 243, 0.1)"},children:(0,n.jsxs)(v.Ay,{container:!0,sx:{height:"100%",flexWrap:"nowrap"},children:[(0,n.jsxs)(v.Ay,{item:!0,sx:{width:{xs:"100%",sm:"320px"},height:"100%",borderRight:"1px solid",borderColor:"divider",display:{xs:q?"none":"flex",sm:"flex"},flexDirection:"column",backgroundColor:"#f5f7fa"},children:[(0,n.jsxs)(h.A,{sx:{p:2,backgroundColor:"white"},children:[(0,n.jsx)(p.A,{variant:"h6",sx:{mb:2,fontWeight:600},children:"消息"}),(0,n.jsx)(f.A,{fullWidth:!0,size:"small",placeholder:"搜索对话",value:O,onChange:e=>Y(e.target.value),InputProps:{startAdornment:(0,n.jsx)(A.A,{position:"start",children:(0,n.jsx)(S.A,{fontSize:"small"})})},sx:{mb:2}}),(0,n.jsxs)(g.A,{value:G,onChange:(e,t)=>K(t),indicatorColor:"primary",textColor:"primary",variant:"fullWidth",sx:{backgroundColor:"#f5f7fa",borderRadius:1,"& .MuiTabs-indicator":{height:"3px",borderRadius:"3px"}},children:[(0,n.jsx)(D,{label:"全部"}),(0,n.jsx)(D,{label:"未读"})]})]}),(0,n.jsx)(j.A,{sx:{overflow:"auto",flexGrow:1,p:1,backgroundColor:"#f5f7fa",height:"100%",overflowY:"auto"},children:V&&0===s.length?(0,n.jsx)(h.A,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,n.jsx)(y.A,{size:24})}):Z.length>0?Z.filter(e=>0===G||e.unreadCount>0).map(e=>{var t,i,s;let o=e.participants.filter(e=>e.id!==(null==r?void 0:r.id)),m=o.map(e=>e.name).join(", "),v=(null==q?void 0:q.id)===e.id,f=e.unreadCount>0;return(0,n.jsxs)(l.Ay,{alignItems:"flex-start",sx:{cursor:"pointer",backgroundColor:v?"action.selected":"background.paper","&:hover":{backgroundColor:"action.hover"},borderRadius:1,mb:.5,px:2,py:1.5},onClick:()=>B(e),children:[(0,n.jsx)(a.A,{children:(0,n.jsx)(d.A,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},badgeContent:e.online&&(0,n.jsx)(I,{sx:{color:"success.main",fontSize:12,backgroundColor:"background.paper",borderRadius:"50%"}}),children:(0,n.jsx)(c.A,{src:(0,T.TW)(null===(t=o[0])||void 0===t?void 0:t.avatar),alt:m})})}),(0,n.jsx)(x.A,{primary:(0,n.jsxs)(h.A,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,n.jsx)(p.A,{variant:"subtitle2",sx:{fontWeight:f?"bold":"normal",color:f?"text.primary":"text.secondary"},children:m}),(0,n.jsx)(p.A,{variant:"caption",color:"text.secondary",children:(0,T.Yq)(null===(i=e.lastMessage)||void 0===i?void 0:i.timestamp)})]}),secondary:(0,n.jsxs)(h.A,{component:"span",sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)(p.A,{component:"span",variant:"body2",color:"text.secondary",sx:{fontWeight:f?"bold":"normal",color:f?"text.primary":"text.secondary",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"180px"},children:null===(s=e.lastMessage)||void 0===s?void 0:s.content}),f&&(0,n.jsx)(u.A,{component:"span",label:e.unreadCount,color:"primary",size:"small",sx:{height:20,width:20,borderRadius:"50%"}})]})})]},e.id)}):(0,n.jsx)(h.A,{sx:{textAlign:"center",p:3},children:(0,n.jsx)(p.A,{color:"text.secondary",children:O?"没有找到匹配的对话":"暂无消息"})})})]}),(0,n.jsx)(v.Ay,{item:!0,sx:{flexGrow:1,height:"100%",display:{xs:q?"flex":"none",sm:"flex"},flexDirection:"column",overflow:"hidden"},children:q?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(h.A,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider",display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:"white",position:"sticky",top:0,zIndex:10},children:[(0,n.jsxs)(h.A,{sx:{display:"flex",alignItems:"center"},children:[(0,n.jsx)(c.A,{src:(0,T.TW)(null===(e=q.participants[0])||void 0===e?void 0:e.avatar),alt:null===(t=q.participants[0])||void 0===t?void 0:t.name,sx:{mr:1}}),(0,n.jsxs)(h.A,{children:[(0,n.jsx)(p.A,{variant:"subtitle1",sx:{fontWeight:600},children:q.participants.filter(e=>e.id!==(null==r?void 0:r.id)).map(e=>e.name).join(", ")}),(0,n.jsx)(p.A,{variant:"caption",color:"text.secondary",children:q.online?"在线":"离线"})]})]}),(0,n.jsx)(b.A,{children:(0,n.jsx)(M.A,{})})]}),(0,n.jsx)(h.A,{sx:{p:2,flexGrow:1,overflow:"auto",backgroundColor:"#f9f9f9",height:"100%",display:"flex",flexDirection:"column",position:"relative"},children:V?(0,n.jsx)(h.A,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,n.jsx)(y.A,{size:24})}):C.length>0?(0,n.jsxs)(h.A,{sx:{flexGrow:1,overflowY:"auto",pb:2},children:[C.map(e=>{let t=e.sender===(null==r?void 0:r.id),i=s.flatMap(e=>e.participants).find(t=>t.id===e.sender);return(0,n.jsxs)(h.A,{sx:{display:"flex",flexDirection:"column",alignItems:t?"flex-end":"flex-start",mb:2},children:[(0,n.jsxs)(h.A,{sx:{display:"flex",alignItems:"flex-end"},children:[!t&&(0,n.jsx)(c.A,{src:(0,T.TW)(null==i?void 0:i.avatar),alt:(null==i?void 0:i.name)||"用户",sx:{width:32,height:32,mr:1}}),(0,n.jsx)(m.A,{elevation:0,sx:{p:1.5,borderRadius:2,maxWidth:"70%",backgroundColor:t?"primary.main":"grey.100",color:t?"primary.contrastText":"text.primary",ml:+!!t,mr:+!t},children:(0,n.jsx)(p.A,{variant:"body2",children:e.content})}),t&&(0,n.jsx)(c.A,{src:(0,T.TW)(null==r?void 0:r.avatar),alt:(null==r?void 0:r.name)||"当前用户",sx:{width:32,height:32,ml:1}})]}),(0,n.jsx)(p.A,{variant:"caption",color:"text.secondary",sx:{mt:.5,mx:6},children:(0,T.Yq)(e.createdAt)})]},e.id)}),(0,n.jsx)("div",{ref:J})]}):(0,n.jsx)(h.A,{sx:{textAlign:"center",p:3},children:(0,n.jsx)(p.A,{color:"text.secondary",children:"暂无消息，开始对话吧"})})}),(0,n.jsx)(h.A,{sx:{p:2,borderTop:"1px solid",borderColor:"divider",backgroundColor:"white",position:"sticky",bottom:0,width:"100%",zIndex:2,minHeight:"100px"},children:(0,n.jsx)(f.A,{fullWidth:!0,multiline:!0,rows:2,maxRows:4,placeholder:"输入消息...",value:N,onChange:e=>_(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),Q())},variant:"outlined",InputProps:{endAdornment:(0,n.jsxs)(A.A,{position:"end",children:[(0,n.jsx)(b.A,{size:"small",sx:{color:"text.secondary"},children:(0,n.jsx)(k,{})}),(0,n.jsx)(b.A,{size:"small",sx:{color:"text.secondary"},children:(0,n.jsx)(z,{})}),(0,n.jsx)(b.A,{size:"small",sx:{color:"text.secondary"},children:(0,n.jsx)(E,{})}),(0,n.jsx)(w.A,{variant:"contained",endIcon:(0,n.jsx)(R.A,{}),onClick:Q,disabled:!N.trim(),sx:{ml:1},children:"发送"})]})}})})]}):(0,n.jsx)(h.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:(0,n.jsx)(p.A,{color:"text.secondary",children:"选择一个对话开始聊天"})})})]})})}):(0,n.jsx)(P.A,{children:(0,n.jsx)(h.A,{sx:{textAlign:"center",py:8},children:(0,n.jsx)(p.A,{children:"请先登录以查看您的消息"})})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[827,364,34,951,948,582,501,680,988,441,684,358],()=>t(1409)),_N_E=e.O()}]);